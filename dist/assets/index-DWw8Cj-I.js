(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const B=100,w=50;function X(){return{maxHp:B,hp:B,level:1,xp:0,xpToNext:w}}function T(e,t){let s=e.maxHp,o=1;for(const{def:n,count:r}of t)n.hpBonus&&(s+=n.hpBonus*r),n.xpMod&&(o*=n.xpMod*r);return{...e,maxHp:s,xpToNext:Math.floor(w*Math.pow(1.2,e.level-1)/o)}}function k(e,t,s){let o=e.xp+t,n=e.level,r=Math.floor(w*Math.pow(1.2,n-1));for(;o>=r;)o-=r,n++,r=Math.floor(w*Math.pow(1.2,n-1));const c={...e,xp:o,level:n,xpToNext:r,maxHp:e.maxHp+(n-e.level)*10};return T(c,s)}function P(e){for(const{def:t}of e)if(t.ruleMod)return t.ruleMod}const O=[3],H=[2,3];function Y(e){if(!e)return{birth:O,survive:H};const t=[],s=[],o=e.toLowerCase().match(/b(\d+)|birth\s*(\d+)/),n=e.toLowerCase().match(/s(\d+)|survive\s*(\d+)/);if(o){const r=o[1]??o[2]??"3";t.push(...r.split("").map(Number))}else t.push(...O);if(n){const r=n[1]??n[2]??"23";s.push(...r.split("").map(Number))}else s.push(...H);return{birth:t,survive:s}}function F(e,t,s){var c;const o=e.length,n=((c=e[0])==null?void 0:c.length)??0;let r=0;for(let l=-1;l<=1;l++)for(let a=-1;a<=1;a++){if(l===0&&a===0)continue;const i=(t+l+o)%o,u=(s+a+n)%n;r+=e[i][u]}return r}function U(e,t){var l;const{birth:s,survive:o}=Y(t),n=e.length,r=((l=e[0])==null?void 0:l.length)??0,c=e.map(a=>[...a]);for(let a=0;a<n;a++)for(let i=0;i<r;i++){const u=F(e,a,i);e[a][i]===1?c[a][i]=o.includes(u)?1:0:c[a][i]=s.includes(u)?1:0}return c}function V(e,t){return Array.from({length:e},()=>Array.from({length:t},()=>0))}function z(e,t,s){var n;const o=e.map(r=>[...r]);return((n=o[t])==null?void 0:n[s])!==void 0&&(o[t][s]=1-o[t][s]),o}const W=24,K=36;function A(e,t){return{id:e,grid:V(W,K),phase:"edit",stepCount:0,ruleMod:t}}function q(e,t,s){return e.phase!=="edit"?e:{...e,grid:z(e.grid,t,s)}}function j(e){return e.phase!=="edit"?e:{...e,phase:"alive",stepCount:0}}function J(e){return e.phase!=="alive"?e:{...e,grid:U(e.grid,e.ruleMod),stepCount:e.stepCount+1}}function Q(e){return{...e,phase:"complete"}}function M(e){var t;return{rows:e.grid.length,cols:((t=e.grid[0])==null?void 0:t.length)??0}}const N=[{id:"lens",name:"Lens of Order",description:"Life follows B3/S23 (classic).",ruleMod:"B3/S23"},{id:"chaos_seed",name:"Chaos Seed",description:"Birth on 2 or 3 neighbors — more growth.",ruleMod:"B23/S36"},{id:"heart_amulet",name:"Heart Amulet",description:"+20 max HP.",hpBonus:20},{id:"xp_gem",name:"Scholar Gem",description:"1.25× XP gain.",xpMod:1.25},{id:"still_life",name:"Still Life",description:"Survive on 2,3,4 — more stable patterns.",ruleMod:"B3/S234"}];function Z(e){return N.find(t=>t.id===e)}function ee(e){const t=N.filter(s=>!e.includes(s.id));return t[Math.floor(Math.random()*t.length)]??N[0]}function te(){const e=[],t=P(e);return{phase:"playing",rooms:[A("0",t)],currentRoomIndex:0,character:X(),inventory:e}}function g(e){return e.rooms[e.currentRoomIndex]??e.rooms[0]}function ne(e){const t=P(e.inventory),s=[...e.rooms,A(String(e.rooms.length),t)];return{...e,rooms:s,currentRoomIndex:s.length-1}}function oe(e,t,s=1){const o=Z(t);if(!o)return e;const n=[...e.inventory],r=n.findIndex(c=>c.def.id===t);return r>=0?n[r]={...n[r],count:n[r].count+s}:n.push({def:o,count:s}),{...e,inventory:n}}function re(e){const t=e.inventory.map(o=>o.def.id),s=ee(t);return oe(e,s.id,1)}function se(e,t,s){let o={...e,character:k(e.character,t,e.inventory)};return o.character=T(o.character,o.inventory),Math.random()<.4&&(o=re(o)),o}const ie="#7ee8a8",ce="#0d0f14",ae="#1e232e",le="rgba(126, 232, 168, 0.15)";function de(e,t,s,o,n,r){var a;const c=t.length,l=((a=t[0])==null?void 0:a.length)??0;e.fillStyle=ce,e.fillRect(0,0,l*o,c*n);for(let i=0;i<c;i++)for(let u=0;u<l;u++){const m=u*o,h=i*n;t[i][u]===1&&(e.fillStyle=ie,e.fillRect(m+.5,h+.5,o-1,n-1))}if(r){e.strokeStyle=ae,e.lineWidth=1;for(let i=0;i<=c;i++)e.beginPath(),e.moveTo(0,i*n),e.lineTo(l*o,i*n),e.stroke();for(let i=0;i<=l;i++)e.beginPath(),e.moveTo(i*o,0),e.lineTo(i*o,c*n),e.stroke()}s==="edit"&&(e.fillStyle=le,e.fillRect(0,0,l*o,c*n))}function ue(e,t,s,o=20){const n=e.width,r=e.height,c=Math.min(o,Math.floor(n/s),Math.floor(r/t)),l=c,a=s*c,i=t*l;return{cellW:c,cellH:l,offsetX:(n-a)/2,offsetY:(r-i)/2}}function pe(e,t,s,o,n,r,c,l,a){const i=a.getBoundingClientRect(),u=a.width/i.width,m=a.height/i.height,h=(c-i.left)*u-e,G=(l-i.top)*m-t,R=Math.floor(h/s),I=Math.floor(G/o);return I>=0&&I<n&&R>=0&&R<r?{row:I,col:R}:null}let d=te(),f={cellW:12,cellH:12,offsetX:0,offsetY:0},L=null;const fe=120,me=document.getElementById("app"),p=document.createElement("canvas");p.id="roomCanvas";const b=document.createElement("header");b.className="header";const v=document.createElement("aside");v.className="sidebar";function $(){b.innerHTML="";const e=document.createElement("h1");e.textContent="Świetlik Koozle";const t=document.createElement("span");t.className="muted",t.textContent=`Room ${d.currentRoomIndex+1} / ${d.rooms.length}`,t.style.color="var(--muted)",b.append(e,t)}function x(){const e=g(d);M(e),v.innerHTML="";const t=document.createElement("div");t.className="panel";const s=document.createElement("div");s.className=`room-status ${e.phase}`,s.textContent=e.phase==="edit"?"Draw on the grid, then start life":e.phase==="alive"?`Life running — step ${e.stepCount}`:"Room complete — go to next",t.appendChild(s);const o=document.createElement("div");o.style.marginTop="0.75rem";const n=document.createElement("button");n.className="btn btn-block",n.textContent=e.phase==="edit"?"Start life":e.phase==="alive"?"Running…":"Next room",n.disabled=e.phase==="alive",n.onclick=()=>{e.phase==="edit"?(y(j(e)),he()):e.phase==="complete"&&(d=se(d,15+e.stepCount),d=ne(d),y(g(d)),S(),$(),x(),C())};const r=document.createElement("button");r.className="btn btn-block",r.textContent="Finish room & get reward",r.style.marginTop="0.5rem",r.disabled=e.phase!=="alive",r.onclick=()=>{e.phase==="alive"&&(S(),y(Q(e)),x(),C())},o.append(n,r),t.append(o),v.appendChild(t);const c=document.createElement("div");c.className="panel";const l=T(d.character,d.inventory);c.innerHTML=`
    <h3>Character</h3>
    <div class="stat-row"><span>Level</span><span>${l.level}</span></div>
    <div class="stat-row"><span>XP</span><span>${l.xp} / ${l.xpToNext}</span></div>
    <div class="stat-row"><span>HP</span><span>${d.character.hp} / ${l.maxHp}</span></div>
    <div class="health-bar"><div class="health-fill" style="width: ${100*d.character.hp/l.maxHp}%"></div></div>
  `,v.appendChild(c);const a=document.createElement("div");a.className="panel",a.innerHTML="<h3>Inventory</h3>";const i=document.createElement("ul");if(i.className="inventory-list",d.inventory.length===0){const u=document.createElement("li");u.textContent="No items yet. Complete rooms for rewards.",u.style.color="var(--muted)",i.appendChild(u)}else for(const{def:u,count:m}of d.inventory){const h=document.createElement("li");h.textContent=`${u.name}${m>1?` ×${m}`:""}`,h.title=u.description,i.appendChild(h)}a.appendChild(i),v.appendChild(a)}function y(e){const t=[...d.rooms];t[d.currentRoomIndex]=e,d={...d,rooms:t}}function he(){S(),L=window.setInterval(()=>{const e=g(d);e.phase==="alive"&&(y(J(e)),x(),C())},fe)}function S(){L!=null&&(clearInterval(L),L=null)}function C(){const e=g(d);M(e);const t=p.getContext("2d");t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,p.width,p.height),t.restore(),t.save(),t.translate(f.offsetX,f.offsetY),de(t,e.grid,e.phase,f.cellW,f.cellH,e.phase==="edit"||f.cellW>=14),t.restore()}function D(){const t=p.parentElement.getBoundingClientRect(),s=g(d),{rows:o,cols:n}=M(s);p.width=t.width,p.height=t.height,f=ue(p,o,n,22),C()}function ve(e){const t=g(d);if(t.phase!=="edit")return;const{rows:s,cols:o}=M(t),n=pe(f.offsetX,f.offsetY,f.cellW,f.cellH,s,o,e.clientX,e.clientY,p);n&&(y(q(t,n.row,n.col)),C())}const E=document.createElement("div");E.className="game-layout";const _=document.createElement("div");_.className="room-canvas-wrap";_.appendChild(p);E.appendChild(b);E.appendChild(_);E.appendChild(v);me.appendChild(E);$();x();D();C();p.addEventListener("click",ve);window.addEventListener("resize",D);
